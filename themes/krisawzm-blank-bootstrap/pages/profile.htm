url = "/profile"
title = "Profile"
description = "New Page"
layout = "one_column"
is_hidden = 0

[editable column_middle]
file = "meetings/column_middle.htm"

[session]
security = "user"
redirect = "signin"
==
function onUpdateUser() {
if (!Auth::check()) {
return null;
} else {
$user = Auth::getUser();
}
$validator = Validator::make(post(),
[
'title' => 'between:1,10',
'name' => 'required|between:2,255',
'surname' => 'between:2,255',
'degrees' => 'between:1,255',
'institution' => 'between:2,511',
'address-line-one' => 'between:2,255',
'address-line-two' => 'between:2,255',
'city' => 'between:2,255',
'country' => 'between:2,255',
'province' => 'between:2,255',
'postal-code' => 'between:2,127',
'phone-one' => 'between:10,127',
'phone-two' => 'between:10,127',
'email' => 'required|email|between:6,255',
'website' => 'between:2,255',
]);
if($validator->fails()) {
throw new \October\Rain\Exception\ValidationException($validator);
}
$user->title = post('title');
$user->name = post('name');
$user->surname = post('surname');
$user->degrees = post('degrees');
$user->institution = post('institution');
$user->address_line_one = post('address-line-one');
$user->address_line_two = post('address-line-two');
$user->city = post('city');
$user->province = post('province');
$user->country = post('country');
$user->postal_code = post('postal-code');
$user->phone_one = post('phone-one');
$user->phone_two = post('phone-two');
$user->email = post('email');
$user->website = post('website');
$user->receive_emails = (post('receive-emails', 0) === 'on');
$user->cmd_member = (post('cmd-member', 0) === 'on');
$user->pie_member = (post('pie-member', 0) === 'on');
$user->cpb_member = (post('cpb-member', 0) === 'on');
$user->eee_member = (post('eee-member', 0) === 'on');

$user->save();

return $user;
}
==
{% put header %}

<div class="section_header">
    <h3>{{'Profile'|_}}</h3>
</div>

{% endput %}


{% put middle_column %}
<script>
    function handleValidationError(jqXHR, textStatus, errorThrown) {
        var errors = jqXHR.responseJSON.X_OCTOBER_ERROR_FIELDS;
        $('.form-group').removeClass('has-error');
        $.each(errors, function(index, element) {
            $('input[name="' + index + '"]').closest('.form-group').addClass('has-error');
        });
    }
</script>

<div class="row">
    <div class="col-md-4">
        <h3>{{ user.title }} {{ user.name }} {{ user.surname }}</h3>
        <table class="table">
            <tbody>
            <tr>
                <th>{{'Member Number'|_}}:</th>
                <td>{{ user.member_number }}</td>
            </tr>
            <tr>
                <th>Divisional Affiliation:</th>
                <td>
                    {% if user.cmd_member %}<span class="label label-warning">{{'CMD'|_}}</span> {% endif %}
                    {% if user.pie_member %}<span class="label label-warning">{{'PIE'|_}}</span> {% endif %}
                    {% if user.cpb_member %}<span class="label label-warning">{{'CPB'|_}}</span> {% endif %}
                    {% if user.eee_member %}<span class="label label-warning">{{'EEE'|_}}</span> {% endif %}
                </td>
            </tr>
            <tr>
                <th>{{'Membership Status'|_}}:</th>
                <td>
                    <div style="text-transform: uppercase;" class="label label-info">{{ user.membership_status }}</div>
                </td>
            </tr>
            <tr>
                <th>{{'Membership Type'|_}}:</th>
                <td>{{ user.membership_type }}</td>
            </tr>
            </tbody>
        </table>
    </div>
    <div class="col-md-8">
        <form data-request="onUpdateUser"
              data-request-redirect="/profile"
              data-request-error="handleValidationError(jqXHR, textStatus, errorThrown)"
              class="form-horizontal">
            <div class="form-group">
                <label for="title" class="col-sm-2 control-label">{{'Title'|_}}</label>
                <div class="col-sm-10">
                    <input type="text" name="title" value="{{ user.title }}" class="form-control">
                </div>
            </div>
            <div class="form-group">
                <label for="title" class="col-sm-2 control-label">{{'Name'|_}}</label>
                <div class="col-sm-10">
                    <input type="text" name="name" value="{{ user.name }}" class="form-control">
                </div>
            </div>
            <div class="form-group">
                <label for="title" class="col-sm-2 control-label">{{'Surname'|_}}</label>
                <div class="col-sm-10">
                    <input type="text" name="surname" value="{{ user.surname }}" class="form-control">
                </div>
            </div>
            <div class="form-group">
                <label for="title" class="col-sm-2 control-label">{{'Degrees'|_}}</label>
                <div class="col-sm-10">
                    <input type="text" name="degrees" value="{{ user.degrees }}" class="form-control">
                </div>
            </div>
            <div class="form-group">
                <label for="title" class="col-sm-2 control-label">{{'Institution'|_}}</label>
                <div class="col-sm-10">
                    <input type="text" name="institution" value="{{ user.institution }}" class="form-control">
                </div>
            </div>
            <div class="form-group">
                <label for="title" class="col-sm-2 control-label">{{'Address 1'|_}}</label>
                <div class="col-sm-10">
                    <input type="text" name="address-line-one" value="{{ user.address_line_one }}" class="form-control">
                </div>
            </div>
            <div class="form-group">
                <label for="title" class="col-sm-2 control-label">{{'Address 2'|_}}</label>
                <div class="col-sm-10">
                    <input type="text" name="address-line-two" value="{{ user.address_line_two }}" class="form-control">
                </div>
            </div>
            <div class="form-group">
                <label for="title" class="col-sm-2 control-label">{{'City'|_}}</label>
                <div class="col-sm-10">
                    <input type="text" name="city" value="{{ user.city }}" class="form-control">
                </div>
            </div>
            <div class="form-group">
                <label for="title" class="col-sm-2 control-label">{{'Province/State'|_}}</label>
                <div class="col-sm-10">
                    <input type="text" name="province" value="{{ user.province }}" class="form-control">
                </div>
            </div>
            <div class="form-group">
                <label for="title" class="col-sm-2 control-label">{{'Country'|_}}</label>
                <div class="col-sm-10">
                    <input type="text" name="country" value="{{ user.country }}" class="form-control">
                </div>
            </div>
            <div class="form-group">
                <label for="title" class="col-sm-2 control-label">{{'Postal/Zip Code'|_}}</label>
                <div class="col-sm-10">
                    <input type="text" name="postal-code" value="{{ user.postal_code }}" class="form-control">
                </div>
            </div>
            <div class="form-group">
                <label for="title" class="col-sm-2 control-label">{{'Phone 1'|_}}</label>
                <div class="col-sm-10">
                    <input type="text" name="phone-one" value="{{ user.phone_one }}" class="form-control">
                </div>
            </div>
            <div class="form-group">
                <label for="title" class="col-sm-2 control-label">{{'Phone 2'|_}}</label>
                <div class="col-sm-10">
                    <input type="text" name="phone-two" value="{{ user.phone_two }}" class="form-control">
                </div>
            </div>
            <div class="form-group">
                <label for="title" class="col-sm-2 control-label">{{'Email'|_}}</label>
                <div class="col-sm-10">
                    <input type="text" name="email" value="{{ user.email }}" class="form-control">
                </div>
            </div>
            <div class="form-group">
                <label for="title" class="col-sm-2 control-label">{{'Website URL'|_}}</label>
                <div class="col-sm-10">
                    <input type="text" name="website" value="{{ user.website }}" class="form-control">
                </div>
            </div>
            <div class="form-group">
                <label for="title" class="col-sm-2 control-label">{{'CMD Member'|_}}</label>
                <div class="col-sm-2">
                    <input type="checkbox" name="cmd-member" {% if user.cmd_member %}checked{% endif %}>
                </div>
            </div>
            <div class="form-group">
                <label for="title" class="col-sm-2 control-label">{{'PIE Member'|_}}</label>
                <div class="col-sm-2">
                    <input type="checkbox" name="pie-member" {% if user.pie_member %}checked{% endif %}>
                </div>
            </div>
            <div class="form-group">
                <label for="title" class="col-sm-2 control-label">{{'CPB Member'|_}}</label>
                <div class="col-sm-2">
                    <input type="checkbox" name="cpb-member" {% if user.cpb_member %}checked{% endif %}>
                </div>
            </div>
            <div class="form-group">
                <label for="title" class="col-sm-2 control-label">{{'EEE Member'|_}}</label>
                <div class="col-sm-2">
                    <input type="checkbox" name="eee-member" {% if user.eee_member %}checked{% endif %}>
                </div>
            </div>

            <div class="form-group">
                <div class="col-sm-offset-2 col-sm-10">
                    <button type="submit" class="btn btn-info">{{'Save'|_}}</button>
                    <button type="reset" class="btn btn-default">{{'Cancel'|_}}</button>
                </div>
            </div>
        </form>
    </div>
</div>

{% endput %}