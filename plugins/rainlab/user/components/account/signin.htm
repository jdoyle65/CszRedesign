
<form
    data-request="onSignin"
    data-request-success="handleResponse(data)"
    data-request-data="redirect: '/profile'"
    data-request-error="displayErrors(jqXHR)"
>
    <div class="form-group">
        <label for="userSigninLogin">{{ 'Email'|_ }}</label>
        <input
            name="login"
            type="text"
            class="form-control"
            id="userSigninLogin"
            placeholder="Enter your {{ loginAttributeLabel|lower }}" />
    </div>

    <div class="form-group">
        <label for="userSigninPassword">{{ 'Password'|_ }}</label>
        <input
            name="password"
            type="password"
            class="form-control"
            id="userSigninPassword"
            placeholder="Enter your password" />
        <span id="login-error-block" class="help-block" style="display: none;">{{ 'Invalid username or password'|_ }}</span>
    </div>

    <button type="submit" class="btn btn-default">{{'Sign in'|_}}</button>

    <div class="form-group">
        <a href="/membership">{{ 'login.membership_message' |_ }}</a>
    </div>
</form>

{% put scripts %}
<script>
    $(function() {
        $('input').change(function() {
            $(this).closest('.form-group')
                    .removeClass('has-error');
            $('#login-error-block').hide();
        });
    });
    function displayErrors(jqXHR) {
        $(function() {
            $('#login-error-block').show().closest('.form-group').addClass('has-error');
            var data = jqXHR.responseJSON;
            if(typeof data.X_OCTOBER_ERROR_FIELDS === 'object') {
                for(var e in data.X_OCTOBER_ERROR_FIELDS) {
                    if (typeof data.X_OCTOBER_ERROR_FIELDS[e][0] === 'string') {
                        var formGroup = $('input[name="'+e+'"]').closest('.form-group');
                        formGroup.addClass('has-error');
                    }
                }
            }
        });
    }

    function handleResponse(data) {
        $(function() {

            if(typeof data.errors === 'object') {
                $('#login-error-block').show().closest('.form-group').addClass('has-error');
                for(var e in data.errors) {
                    if (typeof data.errors[e] === 'string') {
                        var formGroup = $('input[name="'+e+'"]').closest('.form-group');
                        formGroup.addClass('has-error');
                    }
                }
            }
        });
    }
</script>
{% endput %}